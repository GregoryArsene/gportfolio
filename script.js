const isTouchMobile=window.matchMedia("(max-width: 1023px)").matches&&("ontouchstart"in window||navigator.maxTouchPoints>0),debounce=(e,t,o=!1)=>{let r;const i=function(...i){const n=o&&!r;clearTimeout(r),r=setTimeout((()=>{r=null,o||e.apply(this,i)}),t),n&&e.apply(this,i)};return i.cancel=()=>clearTimeout(r),i},EASES={customInOut:null,menuLinkReveal:null,reveal:null,init(){return this.customInOut||(this.customInOut=CustomEase.create("custom","M0,0,C0.16,1,0.30,1,1,1"),this.menuLinkReveal=CustomEase.create("custom","M0,0 C0.25,0.1 0.25,1 1,1"),this.reveal=CustomEase.create("custom","M0,0 C0.2,0.6 0.34,1 1,1")),this}};let smoother;function initScrollSmoother(){return smoother&&(smoother.kill(),smoother=null),isTouchMobile?(console.log("ScrollSmoother et ScrollTrigger désactivés pour les écrans tactiles < 1024px."),ScrollTrigger?.disable(!0),null):(console.log("ScrollSmoother activé."),smoother=ScrollSmoother.create({wrapper:"#smooth-wrapper",content:"#smooth-content",smooth:1.2,effects:!0,speed:1.2,normalizeScroll:!0}),smoother)}const menuElementsCache=new WeakMap,menuCallbacks=new WeakMap;function initMenu(){const e=document.querySelector(".menu"),t=document.querySelector(".menu-trigger"),o=document.querySelector(".menu-background-overlay");if(!e||!t||!o)return console.error("Élément de menu, de déclencheur ou de fond manquant."),{openMenu:()=>{},closeMenu:()=>{},isMenuOpen:()=>!1,cleanup:()=>{}};gsap.set(e,{x:"100%"});let r=!1,i=menuElementsCache.get(e);i||(i={triggerText:document.querySelectorAll(".menu-trigger_text"),linkTitles:document.querySelectorAll(".primary-nav_title"),linkNumbers:document.querySelectorAll(".primary-nav_num"),social:document.querySelectorAll(".secondary-nav_title"),label:document.querySelectorAll(".menu-bottom_label")},menuElementsCache.set(e,i));const n=o=>{r=o,document.body.classList.toggle("menu-open",o),e.setAttribute("aria-hidden",!o),t.setAttribute("aria-expanded",o)},a=gsap.timeline({paused:!0,defaults:{overwrite:"auto"},onStart:()=>n(!0)}).to(e,{x:"0%",duration:.6,ease:EASES.reveal}).to(o,{opacity:.4,duration:.6},"<").to(i.triggerText,{y:"-100%",duration:.5,ease:EASES.menuLinkReveal},"<").fromTo([...i.linkTitles,...i.linkNumbers,...i.social,...i.label],{y:"200%"},{y:"0%",duration:.5,stagger:.05,ease:EASES.menuLinkReveal},"<0.2"),s=gsap.timeline({paused:!0,defaults:{overwrite:"auto"},onStart:()=>n(!1)}).to(e,{x:"100%",duration:.4,ease:EASES.reveal}).to(o,{opacity:0,duration:.4},"<").to(i.triggerText,{y:"0%",duration:.3,ease:EASES.menuLinkReveal},"<"),l=()=>{r||(s.pause(),a.restart())},c=()=>{r&&(a.pause(),s.restart())},u=o=>{t.contains(o.target)?(o.stopPropagation(),r?c():l()):r&&!e.contains(o.target)&&c()},d=e=>{"Escape"===e.key&&r&&c()},m={handleClick:u,handleKeydown:d};menuCallbacks.set(e,m),document.addEventListener("click",u,{passive:!0}),document.addEventListener("keydown",d,{passive:!0});return{openMenu:l,closeMenu:c,isMenuOpen:()=>r,cleanup:()=>{const t=menuCallbacks.get(e);t&&(document.removeEventListener("click",t.handleClick),document.removeEventListener("keydown",t.handleKeydown),menuCallbacks.delete(e)),a.kill(),s.kill(),menuElementsCache.delete(e)}}}function resetWebflow(){try{window.Webflow?.destroy(),window.Webflow?.ready(),window.Webflow?.require("ix2")?.init()}catch(e){console.error("Webflow reset error:",e)}}function initVideoPlayer(){const e={morphPath1:document.getElementById("morphPath1"),morphPath2:document.getElementById("morphPath2"),videoControls:document.getElementById("videoControls"),videoControlsText:document.getElementById("videoControlsText"),videoIndicator:document.getElementById("videoIndicator"),videoTitle:document.getElementById("videoTitle"),videoDuration:document.getElementById("videoDuration"),videoIdTop:document.getElementById("VideoIdTop"),videoIdBtm:document.getElementById("VideoIdBtm"),video:document.querySelector("video")};if(!e.video||!e.morphPath1||!e.morphPath2)return{play:()=>{},pause:()=>{},toggle:()=>{},isPlaying:()=>!1,cleanup:()=>{}};const t={isPlaying:!1,hideTimeout:null,isHovering:!1},o=e=>{const t=Math.floor(e/60),o=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},r=(e,t,o=.5)=>{const r=e.filter(Boolean);0!==r.length&&gsap.to(r,{duration:o,opacity:t,ease:"power2.out"})},i=o=>{const i=[e.videoTitle,e.videoDuration],n=[e.videoIdTop,e.videoIdBtm,e.videoControls];!o&&t.isHovering||r(i,o?1:0),(o||!t.isHovering&&t.isPlaying)&&r(n,o?1:0)},n={play:{path1:"5 2.5 5 12 5 21.5 5 21.5 21 12 5 2.5 5 2.5",path2:"11.7 6.5 11.7 17.5 18.1 13.7 21 12 13.7 7.7 11.7 6.5"},pause:{path1:"5 2.5 5 12 5 21.5 8.3 21.5 8.3 2.5 5 2.5 5 2.5",path2:"15 2.5 15 21.5 18.3 21.5 18.3 12 18.3 2.5 15 2.5"}},a=o=>{const r=n[o?"pause":"play"];gsap.to(e.morphPath1,{duration:.5,attr:{points:r.path1},ease:"power2.inOut"}),gsap.to(e.morphPath2,{duration:o?.5:.3,attr:{points:r.path2},ease:"power2.inOut"}),t.isPlaying=o,e.videoControlsText&&(e.videoControlsText.textContent=o?"PAUSE":"PLAY"),e.videoIndicator&&(e.videoIndicator.style.borderBottomColor=o?"red":""),t.hideTimeout&&(clearTimeout(t.hideTimeout),t.hideTimeout=null),o?t.hideTimeout=setTimeout((()=>i(!1)),3e3):i(!0)},s=async()=>{try{t.isPlaying?e.video.pause():await e.video.play()}catch(e){console.error("Erreur lors de la lecture de la vidéo:",e),a(!1)}},l={click:()=>s(),mouseenter:()=>{t.isHovering=!0,i(!0)},mouseleave:()=>{t.isHovering=!1,t.isPlaying&&(t.hideTimeout&&clearTimeout(t.hideTimeout),t.hideTimeout=setTimeout((()=>i(!1)),3e3))},play:()=>{t.isPlaying||a(!0)},pause:()=>{t.isPlaying&&a(!1)},timeupdate:()=>{if(e.video&&e.videoDuration){const t=e.video.duration-e.video.currentTime;e.videoDuration.textContent=o(t)}},loadedmetadata:()=>{e.videoDuration&&e.video.duration&&(e.videoDuration.textContent=o(e.video.duration))}};e.morphPath1.setAttribute("points",n.play.path1),e.morphPath2.setAttribute("points",n.play.path2),e.videoControlsText&&(e.videoControlsText.textContent="PLAY"),Object.entries(l).forEach((([t,o])=>{e.video.addEventListener(t,o,{passive:!0})})),e.video.duration&&l.loadedmetadata();return{play:()=>a(!0),pause:()=>a(!1),toggle:s,isPlaying:()=>t.isPlaying,cleanup:()=>{t.hideTimeout&&clearTimeout(t.hideTimeout),Object.entries(l).forEach((([t,o])=>{e.video.removeEventListener(t,o)}))}}}function highlightCurrentPageDot(){const e=window.location.pathname.split("/").pop().replace(".html","")||"home_page_no_dot";if(document.querySelectorAll(".header-item_dot").forEach((e=>e.classList.remove("active-dot"))),["projects","about","lab"].includes(e)){const t=document.getElementById(`${e}-dot`);t?.classList.add("active-dot")}}function initHeaderAnimation(){const e=document.querySelector(".header-logo"),t=gsap.utils.toArray(".header_list-item");if(!e&&0===t.length)return;gsap.set([e,...t],{clearProps:"all"});const o=gsap.timeline({defaults:{overwrite:"auto",ease:EASES.reveal}});e&&(gsap.set(e,{y:"300%"}),o.to(e,{y:"0%",duration:.5})),t.length>0&&(gsap.set(t,{y:"200%"}),o.to(t,{y:"0%",duration:.5,stagger:.1},e?"<0.2":0))}function setupHeaderVisibilityObserver(){const e=document.querySelector(".header-nav");if(!e)return;let t,o=!1;return t=new ResizeObserver((e=>{const t=e[0].contentRect.height>0;if(t&&!o)o=!0,requestAnimationFrame((()=>initHeaderAnimation()));else if(!t&&o){o=!1;const e=[document.querySelector(".header-logo"),...gsap.utils.toArray(".header_list-item")];gsap.set(e,{clearProps:"all"})}})),t.observe(e),()=>{t?.disconnect()}}function initSplitTextAnimations(){if(isTouchMobile){document.querySelectorAll('[data-line-reveal="true"], [data-prevent-flicker="true"]').forEach((e=>{gsap.set(e,{visibility:"visible",autoAlpha:1})}));const e=document.querySelector(".about-hero_num");return e&&gsap.set(e,{autoAlpha:1}),Promise.resolve()}if("undefined"==typeof gsap||"undefined"==typeof SplitText)return Promise.resolve();const e=document.querySelector(".about-hero_num");if(e){gsap.set(e,{autoAlpha:1});const t=new SplitText(e,{type:"chars"});gsap.from(t.chars,{yPercent:100,stagger:.1,duration:.75,ease:CustomEase.create("custom","M0,0 C0.2,0.6 0.34,1 1,1")})}return new Promise((e=>{document.fonts.ready.then((()=>{ScrollTrigger.getAll().forEach((e=>{e.vars.trigger&&e.vars.trigger.hasAttribute("data-line-reveal")&&e.kill()})),document.querySelectorAll("[data-line-reveal='true']").forEach((e=>{e.hasAttribute("data-split-processed")&&(e.removeAttribute("data-split-processed"),gsap.set(e,{clearProps:"all"}),e.querySelectorAll(".line").forEach((e=>{e.parentNode&&e.parentNode.replaceChild(document.createTextNode(e.textContent),e)})),e.normalize())})),setTimeout((()=>{document.querySelectorAll("[data-line-reveal='true']").forEach((e=>{if(!e.hasAttribute("data-split-processed")&&(e.offsetParent||0!==e.offsetHeight))try{SplitText.create(e,{type:"lines",autoSplit:!0,mask:"lines",linesClass:"line",onSplit:t=>gsap.timeline({scrollTrigger:{trigger:e,start:"top bottom",end:"top 90%",once:!0,refreshPriority:-1}}).from(t.lines,{yPercent:110,duration:.75,ease:CustomEase.create("custom","M0,0 C0.2,0.6 0.34,1 1,1"),stagger:{amount:.2}})}),gsap.set(e,{visibility:"visible"}),e.setAttribute("data-split-processed","true")}catch(e){console.error("Erreur lors de la création de SplitText:",e)}})),ScrollTrigger.refresh(),e()}),50)}))}))}function manageCardHoverAnimations(){gsap.utils.toArray(".home-work_card-visual").forEach((e=>{e._cleanup&&e._cleanup();const t=e.querySelector(".card-label_path"),o=e.querySelector(".card-label_text");if(!t||!o)return;gsap.set([o,t],{opacity:0,y:"20%",drawSVG:"0%"});const r=gsap.timeline({paused:!0}).to(t,{drawSVG:"100%",duration:.75,ease:CustomEase.create("custom","M0,0 C0.45,0 0,1 1,1")}).to(o,{opacity:1,y:"0%",duration:.3,ease:EASES.reveal},"<0.2"),i=()=>r.play(),n=()=>r.reverse();e.addEventListener("mouseenter",i,{passive:!0}),e.addEventListener("mouseleave",n,{passive:!0}),e._cleanup=()=>{r.kill(),e.removeEventListener("mouseenter",i),e.removeEventListener("mouseleave",n)}}))}function initHomeHeroAnimations(){const e=document.querySelector(".home-hero_path"),t=document.querySelector(".home-hero_text"),o=document.querySelector(".main-cta");if(!e||!t)return;const r=gsap.timeline({delay:1.5});r.from(e,{drawSVG:"0%",autoAlpha:0,duration:.75,ease:CustomEase.create("custom","M0,0 C0.45,0 0,1 1,1")}).from(t,{y:"20%",autoAlpha:0,duration:.75,ease:EASES.reveal},"<0.1"),o&&r.to(o,{y:"0%",duration:.75,ease:EASES.reveal},"<")}function initViewSwitcher(){const e=document.querySelector(".btn-view-grid"),t=document.querySelector(".btn-view-index"),o=document.querySelector(".work-grid"),r=document.querySelector(".work-index"),i=document.querySelector(".work-views-container");if(!(e&&t&&o&&r&&i))return;const n={currentView:"grid",isTransitioning:!1};e.classList.add("is-active");const a=(e,t,o)=>{if(n.currentView===e||n.isTransitioning)return;n.isTransitioning=!0;const r={target:(()=>{gsap.set(t,{position:"relative",visibility:"hidden",opacity:1});const e=t.offsetHeight;return gsap.set(t,{position:"absolute",visibility:"hidden",opacity:0}),e})(),current:o.offsetHeight};gsap.set(i,{height:r.current}),gsap.set([t,o],{position:"absolute"});gsap.timeline({onComplete:()=>{gsap.set(t,{position:"relative",clearProps:"height,width,top,left"}),gsap.set(i,{clearProps:"height"}),gsap.set(o,{visibility:"hidden"}),n.currentView=e,n.isTransitioning=!1,ScrollTrigger.refresh()}}).to(i,{height:r.target,duration:.4,ease:"power2.inOut"}).to(o,{opacity:0,duration:.3},0).to(t,{opacity:1,visibility:"visible",duration:.3},.1)},s=()=>{"grid"!==n.currentView&&([e,t].forEach((e=>e.classList.remove("is-active"))),e.classList.add("is-active"),a("grid",o,r))},l=()=>{"index"!==n.currentView&&([e,t].forEach((e=>e.classList.remove("is-active"))),t.classList.add("is-active"),a("index",r,o))};return e.addEventListener("click",s,{passive:!0}),t.addEventListener("click",l,{passive:!0}),()=>{e.removeEventListener("click",s),t.removeEventListener("click",l)}}function initLabGallery(){const e=document.querySelector(".lab-gallery_content");if(!e)return;const t=Array.from(e.querySelectorAll(".lab-grid_item"));if(0===t.length)return;const o=()=>{const o=getComputedStyle(e),r=o.getPropertyValue("grid-template-columns").split(" ").filter((e=>e&&"0px"!==e)).length;if(0===r)return;const{rowGap:i,columnGap:n}=o,a=Array.from({length:r},(()=>[]));t.forEach(((e,t)=>{a[t%r].push(e)}));const s=document.createDocumentFragment(),l=(r-1)/2,c=[];a.forEach(((e,t)=>{const o=document.createElement("div");o.className="lab-gallery_column",o.style.cssText=`display: flex; flex-direction: column; gap: ${i}`,e.forEach((e=>o.appendChild(e))),s.appendChild(o);const r=.05*Math.abs(t-l);c.push({element:o,lag:r})})),e.innerHTML="",e.appendChild(s),e.style.cssText=`display: flex; gap: ${n}`,smoother&&c.forEach((({element:e,lag:t})=>{smoother.effects(e,{speed:1,lag:t})})),e.classList.add("gallery-is-ready")};document.fonts.ready.then((()=>{setTimeout(o,50)}))}function initializeScrollDependentAnimations(){if(isTouchMobile)return gsap.set('[data-anim-stroke="true"]',{"--stroke-width":"100%"}),gsap.set("[data-illustration]",{y:"0%",autoAlpha:1}),void document.querySelectorAll("[data-image-loader]").forEach((e=>e.classList.add("is-loaded")));ScrollTrigger.batch('[data-anim-stroke="true"]',{once:!0,onEnter:e=>gsap.to(e,{"--stroke-width":"100%",duration:.75,ease:EASES.reveal,stagger:.2})}),gsap.utils.toArray("[data-illustration]").forEach((e=>{gsap.from(e,{y:"200%",autoAlpha:0,duration:.5,ease:EASES.reveal,scrollTrigger:{trigger:e,start:"top 85%",once:!0}})})),document.querySelectorAll("[data-image-loader]").forEach((e=>{const t=e.querySelector("img");if(!t)return;const o=()=>!e.classList.contains("is-loaded")&&e.classList.add("is-loaded");ScrollTrigger.create({trigger:e,start:"top 85%",once:!0,onEnter:()=>t.complete?o():t.addEventListener("load",o,{once:!0})})}))}function initializePageSetup(){setupHeaderVisibilityObserver(),initSplitTextAnimations(),manageCardHoverAnimations(),initHomeHeroAnimations(),initViewSwitcher(),initLabGallery(),initializeScrollDependentAnimations()}async function loadNewPage(e,t=!1){try{const o=await fetch(e);if(!o.ok)throw new Error("Network response was not ok");const r=await o.text(),i=(new DOMParser).parseFromString(r,"text/html"),n=()=>updateContent(i);t&&document.startViewTransition?await document.startViewTransition(n).finished:n(),initializePageSetup()}catch(e){console.error("Error loading new page:",e)}}function updateContent(e){const t=e.querySelector("#main-content"),o=document.querySelector("#main-content");if(t&&o)o.innerHTML=t.innerHTML;else{const t=Array.from(document.querySelectorAll("script[src]"));document.body.innerHTML=e.body.innerHTML,t.forEach((e=>{document.querySelector(`script[src="${e.src}"]`)||document.head.appendChild(e.cloneNode(!0))}))}document.title=e.title,resetPageTheme(e),resetWebflow(),AppState.menu?.cleanup&&AppState.menu.cleanup(),AppState.menu=initMenu();const r=initVideoPlayer();AppState.videoPlayer=r,initScrollSmoother(),smoother?smoother.scrollTo(0,!1):window.scrollTo({top:0,behavior:"instant"}),highlightCurrentPageDot()}function resetPageTheme(e){const t=e.querySelector("html"),o=e.querySelector("body"),r=document.documentElement,i=document.body,n=[];if(t&&r){t.className!==r.className&&n.push((()=>r.className=t.className));const e=t.getAttribute("style"),o=r.getAttribute("style");e!==o&&n.push((()=>{e?r.setAttribute("style",e):r.removeAttribute("style")}))}if(o&&i){o.className!==i.className&&n.push((()=>i.className=o.className));const e=o.getAttribute("style"),t=i.getAttribute("style");e!==t&&n.push((()=>{e?i.setAttribute("style",e):i.removeAttribute("style")}))}const a=Array.from(e.querySelectorAll("head style")).filter((e=>e.textContent.includes("--_colors"))),s=Array.from(document.querySelectorAll("head style")).filter((e=>e.textContent.includes("--_colors")));(a.length>0||s.length>0)&&n.push((()=>{s.forEach((e=>e.remove()));const e=document.createDocumentFragment();a.forEach((t=>{const o=document.createElement("style");o.textContent=t.textContent,e.appendChild(o)})),e.children.length>0&&document.head.appendChild(e)})),n.length>0&&requestAnimationFrame((()=>{n.forEach((e=>e())),document.body.offsetHeight}))}let AppState={};function handleResize(){const{innerWidth:e,innerHeight:t}=window;AppState.resizeAnimationFrame&&cancelAnimationFrame(AppState.resizeAnimationFrame),AppState.resizeAnimationFrame=requestAnimationFrame((()=>{try{manageCardHoverAnimations(),e>568&&AppState.menu?.isMenuOpen()&&AppState.menu.closeMenu(!0),AppState.scrollRefreshTimeout&&clearTimeout(AppState.scrollRefreshTimeout),AppState.scrollRefreshTimeout=setTimeout((()=>{ScrollTrigger.refresh()}),100)}catch(e){console.error("Error in resize handler:",e)}}))}function initApp(){try{const e=[ScrollTrigger,ScrollSmoother,CustomEase,SplitText,DrawSVGPlugin,MorphSVGPlugin,Flip].filter((e=>e));e.length>0&&gsap.registerPlugin(...e),EASES.init(),AppState.menu=initMenu(),initScrollSmoother(),AppState.videoPlayer=initVideoPlayer(),highlightCurrentPageDot(),initializePageSetup();const t=debounce(handleResize,150,!1);window.addEventListener("resize",t,{passive:!0}),window.navigation&&window.navigation.addEventListener("navigate",(e=>{try{const t=new URL(e.destination.url),o=location.origin===t.origin,r=t.href!==location.href;o&&r&&e.intercept({async handler(){try{AppState.menu?.isMenuOpen()&&(AppState.menu.closeMenu(),await new Promise((e=>setTimeout(e,200)))),await loadNewPage(t.href,!0)}catch(e){console.error("Navigation intercept error:",e),window.location.href=t.href}}})}catch(e){console.error("Navigation error:",e)}})),window.addEventListener("error",(e=>{console.error("Uncaught error:",e.error)})),window.addEventListener("unhandledrejection",(e=>{console.error("Unhandled promise rejection:",e.reason)}))}catch(e){console.error("Critical error during app initialization:",e)}}document.addEventListener("DOMContentLoaded",initApp);