const debounce=(e,t,o=!1)=>{let r;return function(...n){const i=o&&!r;clearTimeout(r),r=setTimeout((()=>{r=null,o||e.apply(this,n)}),t),i&&e.apply(this,n)}},EASES={customInOut:CustomEase.create("custom","M0,0,C0.16,1,0.30,1,1,1"),menuLinkReveal:CustomEase.create("custom","M0,0 C0.25,0.1 0.25,1 1,1"),reveal:CustomEase.create("custom","M0,0 C0.2,0.6 0.34,1 1,1")};let smoother;function isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||navigator.maxTouchPoints>0||window.innerWidth<=768}function isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1}function initScrollSmoother(){smoother&&(smoother.kill(),ScrollTrigger.getAll().forEach((e=>e.kill())));const e=isMobileDevice(),t=isIOS();if(e||t){smoother=null;const e=document.querySelector("#smooth-wrapper"),t=document.querySelector("#smooth-content");return e&&t&&(gsap.set(e,{clearProps:"all"}),gsap.set(t,{clearProps:"all"}),e.style.height="auto",e.style.overflow="visible",t.style.transform="none",t.style.willChange="auto"),ScrollTrigger.refresh(),null}return smoother=ScrollSmoother.create({wrapper:"#smooth-wrapper",content:"#smooth-content",smooth:1.2,effects:!0,speed:1,normalizeScroll:!0}),smoother}function initMenu(){const e=document.querySelector(".menu"),t=document.querySelector(".menu-trigger");if(!e||!t)return{openMenu:()=>{},closeMenu:()=>{},isMenuOpen:()=>!1};let o=!1;const r={triggerText:document.querySelectorAll(".menu-trigger_text"),linkTitles:document.querySelectorAll(".primary-nav_title"),linkNumbers:document.querySelectorAll(".primary-nav_num"),social:document.querySelectorAll(".secondary-nav_title"),label:document.querySelectorAll(".menu-bottom_label")},n=gsap.timeline({paused:!0,defaults:{overwrite:"auto"}}).to(e,{x:"0%",opacity:1,duration:.8,ease:EASES.customInOut}).to(r.triggerText,{y:"-100%",duration:.5,ease:EASES.menuLinkReveal},0).fromTo([...r.linkTitles,...r.linkNumbers,...r.social,...r.label],{y:"200%"},{y:"0%",duration:.5,stagger:.05,ease:EASES.menuLinkReveal},.2),i=gsap.timeline({paused:!0,defaults:{overwrite:"auto"}}).to(e,{opacity:0,duration:.2,ease:"power2.inOut"}).to(r.triggerText,{y:"0%",duration:.3,ease:"power2.inOut"},0).set(e,{x:"100%"}),a=()=>{o||(o=!0,document.body.classList.add("menu-open"),n.restart(),e.setAttribute("aria-hidden","false"),t.setAttribute("aria-expanded","true"))},s=(n=!1)=>{o&&(o=!1,document.body.classList.remove("menu-open"),e.setAttribute("aria-hidden","true"),t.setAttribute("aria-expanded","false"),n?(gsap.killTweensOf([e,r.triggerText]),gsap.set(e,{x:"100%",opacity:0}),gsap.set(r.triggerText,{y:"0%"})):i.duration(.2).restart())},l=debounce((()=>{window.innerWidth>568&&o&&s(!0)}),200);return document.addEventListener("click",(r=>{t.contains(r.target)?(r.stopPropagation(),o?s():a()):o&&!e.contains(r.target)&&s()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&o&&s()})),window.addEventListener("resize",l),{openMenu:a,closeMenu:s,isMenuOpen:()=>o}}function resetWebflow(){try{window.Webflow?.destroy(),window.Webflow?.ready(),window.Webflow?.require("ix2")?.init()}catch(e){console.error("Webflow reset error:",e)}}function initVideoPlayer(){let e=!1,t=null,o=!1;const r=document.getElementById("morphPath1"),n=document.getElementById("morphPath2"),i=document.getElementById("videoControls"),a=document.getElementById("videoControlsText"),s=document.getElementById("videoIndicator"),l=document.getElementById("videoTitle"),c=document.getElementById("videoDuration"),u=document.getElementById("VideoIdTop"),d=document.getElementById("VideoIdBtm"),m=document.querySelector("video");function p(e){const t=Math.floor(e/60),o=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}function g(){o||(l&&gsap.to(l,{duration:.5,opacity:0,ease:"power2.out"}),c&&gsap.to(c,{duration:.5,opacity:0,ease:"power2.out"}))}function h(){l&&gsap.to(l,{duration:.5,opacity:1,ease:"power2.out"}),c&&gsap.to(c,{duration:.5,opacity:1,ease:"power2.out"})}function y(){if(o)return;[u,d,i].forEach((e=>{e&&gsap.to(e,{duration:.5,opacity:0,ease:"power2.out"})}))}function f(){[u,d,i].forEach((e=>{e&&gsap.to(e,{duration:.5,opacity:1,ease:"power2.out"})}))}const S={path1:"5 2.5 5 12 5 21.5 5 21.5 21 12 5 2.5 5 2.5",path2:"11.7 6.5 11.7 17.5 18.1 13.7 21 12 13.7 7.7 11.7 6.5"},v={path1:"5 2.5 5 12 5 21.5 8.3 21.5 8.3 2.5 5 2.5 5 2.5",path2:"15 2.5 15 21.5 18.3 21.5 18.3 12 18.3 2.5 15 2.5"};function w(){gsap.to(r,{duration:.5,attr:{points:S.path1},ease:"power2.inOut"}),gsap.to(n,{duration:.3,attr:{points:S.path2},ease:"power2.inOut"}),e=!1,a&&(a.textContent="PLAY"),s&&(s.style.borderBottomColor=""),t&&(clearTimeout(t),t=null),h(),f()}function E(){gsap.to(r,{duration:.5,attr:{points:v.path1},ease:"power2.inOut"}),gsap.to(n,{duration:.5,attr:{points:v.path2},ease:"power2.inOut"}),e=!0,a&&(a.textContent="PAUSE"),s&&(s.style.borderBottomColor="red"),t=setTimeout((()=>{g(),y()}),3e3)}function b(){e?(w(),m&&m.pause()):(E(),m&&m.play().catch((e=>{console.error("Erreur lors de la lecture de la vidéo:",e)})))}return m&&m.addEventListener("click",b),r&&n&&(r.setAttribute("points",S.path1),n.setAttribute("points",S.path2)),a&&(a.textContent="PLAY"),m&&c&&(m.duration?c.textContent=p(m.duration):m.addEventListener("loadedmetadata",(()=>{c.textContent=p(m.duration)})),m.addEventListener("timeupdate",(function(){if(m&&c){const e=m.duration-m.currentTime;c.textContent=p(e)}}))),m&&(m.addEventListener("mouseenter",(()=>{o=!0,h(),f()})),m.addEventListener("mouseleave",(()=>{o=!1,e&&(t&&clearTimeout(t),t=setTimeout((()=>{g(),y()}),3e3))}))),m&&(m.addEventListener("play",(()=>{e||E()})),m.addEventListener("pause",(()=>{e&&w()}))),{play:E,pause:w,toggle:b,isPlaying:()=>e}}function highlightCurrentPageDot(){const e=window.location.pathname.split("/").pop().replace(".html","")||"home_page_no_dot";if(document.querySelectorAll(".header-item_dot").forEach((e=>e.classList.remove("active-dot"))),["projects","about","lab"].includes(e)){const t=document.getElementById(`${e}-dot`);t?.classList.add("active-dot")}}function initHeaderAnimation(){const e=document.querySelector(".header-logo"),t=gsap.utils.toArray(".header_list-item");if(!e&&0===t.length)return;gsap.set([e,...t],{clearProps:"all"}),gsap.set(e,{y:"300%"}),gsap.set(t,{y:"100%"});const o=gsap.timeline({defaults:{overwrite:"auto",ease:CustomEase.create("custom","M0,0 C0.2,0.6 0.34,1 1,1")}});o.to(e,{y:"0%",duration:.5}),o.to(t,{y:"0%",duration:.5,stagger:.1},"<0.2")}function setupHeaderVisibilityObserver(){const e=document.querySelector(".header-nav");if(!e)return;let t=!1;new ResizeObserver((e=>{for(let o of e){const e=o.contentRect.height>0;if(e&&!t)t=!0,initHeaderAnimation();else if(!e&&t){t=!1;const e=document.querySelector(".header-logo"),o=gsap.utils.toArray(".header_list-item");gsap.set([e,...o],{clearProps:"all"})}}})).observe(e)}function initSplitTextAnimations(){if(void 0===window.gsap||void 0===window.SplitText)return Promise.resolve();const e=document.querySelector(".about-hero_num");if(e){gsap.set(e,{autoAlpha:1});const t=new SplitText(e,{type:"chars"});gsap.from(t.chars,{yPercent:100,stagger:.1,duration:.75,ease:CustomEase.create("custom","M0,0 C0.2,0.6 0.34,1 1,1")})}return new Promise((e=>{document.fonts.ready.then((()=>{ScrollTrigger.getAll().forEach((e=>{e.vars.trigger&&e.vars.trigger.hasAttribute("data-line-reveal")&&e.kill()})),document.querySelectorAll("[data-line-reveal='true']").forEach((e=>{e.hasAttribute("data-split-processed")&&(e.removeAttribute("data-split-processed"),gsap.set(e,{clearProps:"all"}),e.querySelectorAll(".line").forEach((e=>{e.parentNode&&e.parentNode.replaceChild(document.createTextNode(e.textContent),e)})),e.normalize())})),setTimeout((()=>{document.querySelectorAll("[data-line-reveal='true']").forEach((e=>{if(!e.hasAttribute("data-split-processed")&&(e.offsetParent||0!==e.offsetHeight))try{SplitText.create(e,{type:"lines",autoSplit:!0,mask:"lines",linesClass:"line",onSplit:t=>gsap.timeline({scrollTrigger:{trigger:e,start:"top bottom",end:"top 90%",once:!0,refreshPriority:-1}}).from(t.lines,{yPercent:110,duration:.75,ease:CustomEase.create("custom","M0,0 C0.2,0.6 0.34,1 1,1"),stagger:{amount:.2}})}),gsap.set(e,{visibility:"visible"}),e.setAttribute("data-split-processed","true")}catch(e){console.error("Erreur lors de la création de SplitText:",e)}})),ScrollTrigger.refresh(),e()}),50)}))}))}function initStrokeAnimations(){ScrollTrigger.batch('[data-anim-stroke="true"]',{once:!0,onEnter:e=>gsap.to(e,{"--stroke-width":"100%",duration:.75,ease:EASES.reveal,stagger:.2})})}function initIllustration(){gsap.utils.toArray("[data-illustration]").forEach((e=>{gsap.from(e,{y:"200%",autoAlpha:0,duration:.5,ease:CustomEase.create("custom","M0,0 C0.2,0.6 0.34,1 1,1"),scrollTrigger:{trigger:e,start:"top 85%",once:!0}})}))}function manageCardHoverAnimations(){const e=window.innerWidth>1024&&navigator.maxTouchPoints<1;gsap.utils.toArray(".home-work_card-visual").forEach((t=>{t._hoverTimeline&&(t._hoverTimeline.kill(),t._hoverTimeline=null),t._mouseEnterHandler&&t.removeEventListener("mouseenter",t._mouseEnterHandler),t._mouseLeaveHandler&&t.removeEventListener("mouseleave",t._mouseLeaveHandler);const o=t.querySelector(".card-label_path"),r=t.querySelector(".card-label_text");if(o&&gsap.set(o,{clearProps:"all"}),r&&gsap.set(r,{clearProps:"all"}),e){if(!o||!r)return;gsap.set(r,{opacity:0,y:"20%"}),gsap.set(o,{drawSVG:"0%"});const e=gsap.timeline({paused:!0});e.to(o,{drawSVG:"100%",duration:.75,ease:CustomEase.create("custom","M0,0 C0.45,0 0,1 1,1")}).to(r,{opacity:1,y:"0%",duration:.3,ease:CustomEase.create("custom","M0,0 C0.2,0.6 0.34,1 1,1")},"<0.2"),t._hoverTimeline=e,t._mouseEnterHandler=()=>e.play(),t._mouseLeaveHandler=()=>e.reverse(),t.addEventListener("mouseenter",t._mouseEnterHandler),t.addEventListener("mouseleave",t._mouseLeaveHandler)}}))}function initHomeHeroAnimations(){const e=document.querySelector(".home-hero_path"),t=document.querySelector(".home-hero_text"),o=document.querySelector(".main-cta");if(!e||!t)return;const r=gsap.timeline({delay:1.5});r.from(e,{drawSVG:"0%",autoAlpha:0,duration:.75,ease:CustomEase.create("custom","M0,0 C0.45,0 0,1 1,1")}),r.from(t,{y:"20%",autoAlpha:0,duration:.75,ease:CustomEase.create("custom","M0,0 C0.2,0.6 0.34,1 1,1")},"<0.1"),o&&gsap.to(o,{y:"0%",duration:.75,ease:CustomEase.create("custom","M0,0 C0.2,0.6 0.34,1 1,1")})}function initImagePlaceholders(){document.querySelectorAll("[data-image-loader]").forEach((e=>{const t=e.querySelector("img");if(!t)return void console.warn("Aucune image trouvée dans le loader:",e);const o=()=>{e.classList.contains("is-loaded")||e.classList.add("is-loaded")};ScrollTrigger.create({trigger:e,start:"top 85%",once:!0,onEnter:()=>{t.complete?o():t.addEventListener("load",o,{once:!0})}}),t.complete&&getComputedStyle(e).top<window.innerHeight&&o()}))}function initViewSwitcher(){const e=document.querySelector(".btn-view-grid"),t=document.querySelector(".btn-view-index"),o=document.querySelector(".work-grid"),r=document.querySelector(".work-index"),n=document.querySelector(".work-views-container");if(!(e&&t&&o&&r&&n))return;const i=[e,t];e.classList.add("is-active");const a=(e,t)=>{const o=t.offsetHeight;gsap.set(e,{position:"relative",visibility:"hidden",opacity:1});const r=e.offsetHeight;gsap.set(e,{position:"absolute",visibility:"hidden",opacity:0}),gsap.set(n,{height:o}),gsap.set(t,{position:"absolute"}),gsap.set(e,{position:"absolute"}),gsap.timeline({onComplete:()=>{gsap.set(e,{position:"relative",clearProps:"height,width,top,left"}),gsap.set(n,{clearProps:"height"}),gsap.set(t,{visibility:"hidden"}),ScrollTrigger.refresh()}}).to(n,{height:r,duration:.4,ease:"power2.inOut"}).to(t,{opacity:0,duration:.3},0).to(e,{opacity:1,visibility:"visible",duration:.3},.1)};i.forEach((t=>{t.addEventListener("click",(()=>{t.classList.contains("is-active")||(i.forEach((e=>e.classList.remove("is-active"))),t.classList.add("is-active"),t===e?a(o,r):a(r,o))}))}))}function initLabGallery(){const e=document.querySelector(".lab-gallery_content");if(!e)return;const t=window.innerWidth>1024&&navigator.maxTouchPoints<1;let o=0;const r=Array.from(e.querySelectorAll(".lab-grid_item"));function n(){const n=window.getComputedStyle(e).getPropertyValue("grid-template-columns").split(" ").filter((e=>"0px"!==e&&e)).length;if(0===n)return;o=n;const i=Array.from({length:n},(()=>[]));r.forEach(((e,t)=>{i[t%n].push(e)}));const a=document.createDocumentFragment(),s=(n-1)/2,l=[];i.forEach(((e,t)=>{const o=document.createElement("div");o.className="lab-gallery_column",e.forEach((e=>o.appendChild(e))),a.appendChild(o);const r=0+.05*Math.abs(t-s);l.push({element:o,lag:r})})),e.innerHTML="",e.appendChild(a),e.style.display="flex",t&&smoother&&l.forEach((({element:e,lag:t})=>{smoother.effects(e,{speed:1,lag:t})})),e.classList.add("gallery-is-ready")}0!==r.length&&document.fonts.ready.then((()=>{setTimeout(n,50)}))}function ajusterAttributsSelonEcran(){const e=navigator.maxTouchPoints>0||window.innerWidth<1024;document.querySelectorAll("[data-anim-stroke]").forEach((t=>{t.dataset.animStroke=e?"false":"true"})),document.querySelectorAll("[data-image-loader]").forEach((t=>{e&&t.classList.add("is-loaded")}))}function initializeAllAnimations(){setupHeaderVisibilityObserver(),initSplitTextAnimations(),initStrokeAnimations(),initIllustration(),manageCardHoverAnimations(),initHomeHeroAnimations(),initImagePlaceholders(),initViewSwitcher(),initLabGallery()}async function loadNewPage(e,t=!1){try{const o=await fetch(e);if(!o.ok)throw new Error("Network response was not ok");const r=await o.text(),n=(new DOMParser).parseFromString(r,"text/html"),i=()=>{updateContent(n),smoother?smoother.scrollTo(0,!1):window.scrollTo(0,0)};if(t&&document.startViewTransition){const e=document.startViewTransition(i);await e.finished}else i();initializeAllAnimations()}catch(e){console.error("Error loading new page:",e)}}function updateContent(e){const t=e.querySelector("#main-content"),o=document.querySelector("#main-content");t&&o?o.innerHTML=t.innerHTML:document.body.innerHTML=e.body.innerHTML,document.title=e.title,resetWebflow(),initVideoPlayer(),initScrollSmoother(),smoother?smoother.scrollTo(0,!1):window.scrollTo(0,0),highlightCurrentPageDot(),initViewSwitcher()}let AppState={};function manageScrollTriggerState(){const e=navigator.maxTouchPoints>0,t=window.innerWidth<1024;e||t?(console.log("ScrollTrigger désactivé pour les appareils tactiles / petits écrans."),ScrollTrigger.disable()):(console.log("ScrollTrigger activé pour le bureau."),ScrollTrigger.enable())}function handleResize(){ajusterAttributsSelonEcran(),manageScrollTriggerState(),manageCardHoverAnimations(),ScrollTrigger.refresh()}function initApp(){gsap.registerPlugin(ScrollTrigger,ScrollSmoother,CustomEase,SplitText,DrawSVGPlugin,MorphSVGPlugin,Flip),ajusterAttributsSelonEcran(),manageScrollTriggerState(),AppState.menu=initMenu(),initScrollSmoother(),initVideoPlayer(),highlightCurrentPageDot(),initializeAllAnimations(),window.addEventListener("resize",debounce(handleResize,250)),window.navigation&&navigation.addEventListener("navigate",(e=>{const t=new URL(e.destination.url);location.origin===t.origin&&t.href!==location.href&&e.intercept({async handler(){AppState.menu.isMenuOpen&&AppState.menu.closeMenu(),await loadNewPage(t.href,!0),ajusterAttributsSelonEcran()}})})),window.addEventListener("error",(e=>console.error("Uncaught error:",e.error)))}document.addEventListener("DOMContentLoaded",initApp);